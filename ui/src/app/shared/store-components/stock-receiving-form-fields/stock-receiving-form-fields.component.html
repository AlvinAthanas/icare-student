<div class="container-fluid">
  <hr style="margin-top: 0" />
  <div class="row" *ngIf="!stockInvoiceItem">
    <div class="pl-3 pr-3 col-12">
      <app-form
        [fields]="commonFields"
        [isFormHorizontal]="true"
        (formUpdate)="onFormUpdate($event)"
      ></app-form>
    </div>
  </div>
  <div class="row">
    <div class="p-3 col-12">
      <div class="row" *ngIf="reloadFields">
        <div class="col-12">
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </div>
      </div>
      <div class="row" *ngIf="!reloadFields">
        <div class="col-12">
          <mat-form-field appearance="fill" class="w-100">
            <input
              type="text"
              placeholder="Search item"
              [required]="true"
              matInput
              [value]="selectedItem?.display"
              autocomplete="off"
              (keyup)="searchItemFromOptions($event)"
              [matAutocomplete]="auto"
            />
            <span
              style="
                position: relative;
                float: right;
                margin-top: -30px;
                margin-right: 16px;
              "
            >
              <mat-icon>arrow_drop_down</mat-icon>
            </span>
            <!-- <span
        style="
          position: relative;
          float: right;
          margin-top: -30px;
          font-size: 0.7rem;
        "
      >
        <mat-icon class="text-muted" (click)="onClearValue($event)"
          >clear</mat-icon
        >
      </span> -->
            <mat-autocomplete #auto="matAutocomplete">
              <ng-container *ngFor="let option of members$ | async">
                <mat-option
                  (click)="getSelectedItemFromOption($event, option)"
                  [value]="option"
                >
                  <span>
                    {{ option?.display }}
                  </span>
                </mat-option>
              </ng-container>
            </mat-autocomplete>
          </mat-form-field>
          <!-- <app-form
            [fields]="[itemField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
          <span
            class="text-small text-secondary"
            *ngIf="stockInvoiceItem?.item"
          >
            <i> Selected Item: {{ this.stockInvoiceItem?.item?.display }} </i>
          </span> -->
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            [fields]="[unitField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            [fields]="[orderQuantityField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            [fields]="[packagePriceField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            [fields]="[mfgBatchNumberField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            [fields]="[expiryDateField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-md-6 col-sm-12 col-sx-12">
          <app-form
            *ngIf="batchQuantity"
            [fields]="[batchQuantityField]"
            (formUpdate)="onFormUpdate($event)"
          ></app-form>
        </div>
        <div class="col-12" *ngIf="amount && amount !== 'NaN'">
          <p class="mt-3">
            <span>
              Amount:
              <b>
                {{ amount }}
              </b>
            </span>
            <span class="ml-2">
              Unit price:
              <b>
                {{ unitPrice }}
              </b>
            </span>
          </p>
        </div>
      </div>
    </div>
    <div class="col-12 d-flex justify-content-end">
      <button
        *ngIf="!stockInvoiceItem"
        class="button-round mt-3 {{ validForm ? '' : 'disabled-button' }}"
        color="primary"
        mat-flat-button
        (click)="saveInvoices($event)"
      >
        <mat-icon>add</mat-icon> Add to Draft
      </button>
      <button
        *ngIf="stockInvoiceItem"
        class="button-round mt-3"
        color="primary"
        mat-flat-button
        (click)="updateInvoiceItem($event)"
      >
        <mat-icon>save</mat-icon>
      </button>
    </div>
    <div class="col-12 mb-2" *ngIf="existingStockInvoice">
      <div class="w-100">
        <button
          class="float-right justify-content-end"
          color="primary"
          mat-flat-button
          (click)="onSaveUdatedInvoice($event)"
        >
          <mat-icon>save</mat-icon>
          Save Invoice
        </button>
        <button
          class="float-right mr-2"
          mat-stroked-button
          (click)="onClosePopup($event)"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
