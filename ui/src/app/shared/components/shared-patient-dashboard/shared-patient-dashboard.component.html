<div
  *ngIf="{
    currentPatient: currentPatient$ | async,
    vitalSignObservations: vitalSignObservations$ | async,
    hasConsultationStarted: hasConsultationStarted$ | async,
    startingConsultation: startingConsultation$ | async,
    diagnoses: diagnoses$ | async,
    encounterTypes: encounterTypes$ | async,
    billLoadingState: billLoadingState$ | async,
    loadingPaymentStatus: loadingPaymentStatus$ | async,
    hasPatientHavePendingPaymentForTheCurrentVisitType:
      hasPatientHavePendingPaymentForTheCurrentVisitType$ | async,
    activeVisitDeathStatus: activeVisitDeathStatus$ | async,
    observationsGroupedByConcept: observationsGroupedByConcept$ | async,
    formEntities: consultationForms$ | async,
    loadingForms: loadingForms$ | async,
    currentLocation: currentLocation$ | async,
    forms: forms$ | async,
    countOfVitalsElementsFilled: countOfVitalsElementsFilled$ | async,
    orderTypes: orderTypes$ | async,
    provider: provider$ | async,
    consultationEncounterType: consultationEncounterType$ | async,
    consultationOrderType: consultationOrderType$ | async,
    facilityDetails: facilityDetails$ | async,
    useGeneralPrescription: useGeneralPrescription$ | async,
    generalPrescriptionOrderType: generalPrescriptionOrderType$ | async,
    observationChartForm: observationChartForm$ | async,
    observationChartEncounterType: observationChartEncounterType$ | async,
    visitEndingControlStatusesConcept:
      visitEndingControlStatusesConcept$ | async
  } as dashboardParams"
>
  <div
    class="w-100"
    *ngIf="
      !dashboardParams?.loadingPaymentStatus &&
      dashboardParams?.encounterTypes &&
      !dashboardParams?.billLoadingState &&
      dashboardParams?.currentPatient &&
      dashboardParams?.forms &&
      dashboardParams?.provider &&
      dashboardParams?.consultationEncounterType
    "
  >
    <div class="patient-dashboard-container mat-elevation-z1">
      <div class="patient-profile-sticky">
        <app-new-patient-profile
          [currentPatient]="dashboardParams?.currentPatient"
        ></app-new-patient-profile>
      </div>
      <div class="w-100 patient-other-details-padding">
        <div
          class="
            d-flex
            justify-content-between
            align-items-center
            pt-2
            pl-3
            pr-3
          "
        >
          <div class="w-50 d-flex justify-content-left">
            <button
              class="float-left mr-4"
              mat-stroked-button
              (click)="clearBills($event)"
              matTooltip="Back to List"
            >
              <mat-icon>arrow_back</mat-icon>
              Back to Client List
            </button>
            <div *ngIf="!activeVisit?.waitingToBeAdmitted">
              <button
                *ngFor="let form of dashboardParams?.forms"
                class="mr-2"
                [ngClass]="{
                  'selected-form':
                    (selectedForm && selectedForm?.uuid === form?.uuid) ||
                    (!selectedForm &&
                      dashboardParams?.forms[0]?.uuid === form?.uuid)
                }"
                mat-stroked-button
                [matMenuTriggerFor]="form?.name"
                (click)="getSelectedForm($event, form)"
              >
                {{ form?.name }}
              </button>
            </div>
          </div>

          <!-- <h2 class="text-left ml-2">Patient Dashboard</h2> -->
          <div class="w-50 d-flex justify-content-end">
            <div class="mr-2">
              <app-shared-bmi></app-shared-bmi>
            </div>
            <button
              *ngIf="!isInpatient"
              class="mr-2"
              (click)="onToggleVitalsSummary($event)"
              [ngStyle]="{
                'background-color':
                  dashboardParams?.countOfVitalsElementsFilled === 0
                    ? '#F00'
                    : 'transparent',
                color:
                  dashboardParams?.countOfVitalsElementsFilled === 0
                    ? '#FFF'
                    : '#222'
              }"
              mat-stroked-button
            >
              View Vitals
            </button>
            <div
              class="patient-vitals-mat-menu mat-elevation-z1"
              *ngIf="showVitalsSummary"
            >
              <div class="p-2">
                <button
                  mat-icon-button
                  class="float-right"
                  (click)="onToggleVitalsSummary($event)"
                >
                  <mat-icon> close </mat-icon>
                </button>
                <app-patient-vitals-summary></app-patient-vitals-summary>
              </div>
            </div>

            <span
              class="text-danger mr-2"
              *ngIf="activeVisit?.waitingToBeAdmitted"
            >
              <!-- Waiting to be given a bed -->
              <img
              height="40"
              width="40" 
              src="data:image/png;base64,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" alt="">
            </span>
            <span
              class="mr-2"
              *ngIf="
                !activeVisit?.waitingToBeAdmitted && activeVisit?.isAdmitted
              "
            >
              <img
                height="20"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABmJLR0QA/wD/AP+gvaeTAAAEqUlEQVRYhc2YW2hURxjH/9/MnL3lVovGS28ENa0iFKq1m2wi0j4UQ4wxmrZUKAg2rU9FCn1YrF1aRREsBS20kZbeESnFJESNCD4kGyMGSxG8Uo3QSzReqnGze/bMpQ9bN4m71Wxy1uT/eGbmm9+Zb/4f5zvAFBe5GWz1lo4vlJIbYAgewXf+/PGr4YnGZG6AAUBTU6+lldxQGQzypS8t4Y5Wm9yI6xrghTmDHCDDBYclBGAg3IjrGmC+NOUBx52GYUOAAwCSQyAifW/cGCPqwu1meAWp8RhnXC5uauq1rs64Gq8IBjkXfExr7GQSJ0/2Jlq21vhz2UusjnSUMm2+k1pXM8YvKK3faN264vx4wPMhwbT5aebMWcueevpJ69rAwPN9l6+0AHjuQYuam5c4DR91fNnd0/NOOsUAGJEOVVUyrTWi0eOj1hCRZIJ9misg1YcPJitCQYuxlF+i0e6kTjrTW3euGswl0PLIMV+JEx+sqqoUWmt0d/fIlm01Vq5A94tpQNyDAwACKR7w5XRP8qkpX2ZcAyz/q0gBhpRUcKQECNKNuBl1kDPywqjzb35y5FzclgcU6MBYXD3SOAQy4zFENlFduF1XV4fS9fDXkyf02pfnMr/HwulLN+xTFwckDHpjtt7ctm1Flxub5qKMFGsDMEZYWDYNr78yz7v97WBBfXXZsmIf63gt0vHD8sgx36QCOkqbOzFneAInVCyaRR+ufzFQNqdoTSmS0cZN+x+ZyzPuoFJGXekflAC8I5/7vQIb6xf5vj10dsGZPvM9gLVrNh/ZI7Wz0UzQbETM4Zz9qbT5UUq5q31H7a302Kpwu6qqDqU3iEaP234v1zveDWY9JUcqRL7ujd2NJ2qN5keDlUu54BP79NNaIxYbQv/f/fbA9esJLeXKlu21nUCWN6fUNbx28Y/bWYNZgqOm4pmAR3giBoZNFA4AGGMoKirE/PJ53gULF5QwwQ+vDLe9kBUQAJIJ+VlL56WYMSbbMBY/O4Ok0kGXWxoAwLTHSjCvfL5fcOuXxsb9PCsgt8y+a7fs31q7+pxs4z4PR9nsYtt1uv9UOn06+QP+x+3yQAMzlHlKEkLfScj6ztP9v3/VfjY+GM/knPtEUUG+AAFgzuzZRZbwvvW/7ju0vWYgYZKLz1y+uXfL3hP2NwfPxc5d+Qd2UgEASqcVcPcTPKzikmIoLYMPvOFtkZVDAN5rCB/ecerC9fVn+m6uSzpmfmHASggCM4RAvgC9Hg+MRokgw9I51lpDae1HUl+tC7enJ0sowABxO3V6t+/aqe+8PB4hYwzGaDHqBIkIAGH3pqqHBkg4Eh983pMvPgAGAI0uM0QEIgOls5eXUcsfPmVCMgYgGJNhEkY0NkDkNcOpHShrX0x4f3d0zGE6O8c+N1cRwATuq4OVoYq8bZirurqiamr3JIamdtNkSJPAiBxna7gfpRgjHQpVpg+NDGWahIhcabhzVWPkWKEjEzcAeEY+nzIpHkrELKSqV1oGIHavlwXgaj+bq7SPKRjDtE79wZNSgoiU4Fw0d/f0NMGAE5FknO2aDMBDkZo7DZEj+7qjx9cZgBFIcYvvmQyWnPQvCULmfbqY+pMAAAAASUVORK5CYII="
              />
            </span>
            <button
              *ngIf="isInpatient"
              [disabled]="!activeVisit?.waitingToBeAdmitted"
              mat-stroked-button
              class="mr-2 float-right"
              (click)="onAssignBed($event)"
            >
              Assign Bed
            </button>
            <button
              (click)="onDischargePatient($event)"
              *ngIf="activeVisit?.isAdmitted && isInpatient"
              mat-stroked-button
              class="mr-2 float-right"
            >
              Discharge
            </button>
            <button
              *ngIf="!isInpatient"
              mat-stroked-button
              (click)="
                viewPatientHistory(
                  $event,
                  dashboardParams?.currentPatient?.patient?.uuid
                )
              "
              class="mr-2 float-right"
            >
              History
            </button>
            <button
              *ngIf="!isInpatient"
              class="mr-2"
              mat-stroked-button
              [matMenuTriggerFor]="moreMenuItems"
            >
              More
            </button>
            <mat-menu #moreMenuItems="matMenu">
              <button
                mat-menu-item
                [disabled]="
                  activeVisit?.isAdmitted ||
                  activeVisit?.waitingToBeAdmitted ||
                  activeVisitDeathStatus ||
                  dashboardParams?.startingConsultation ||
                  (!activeVisit?.isEmergency &&
                    dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType) ||
                  activeVisitDeathStatus
                "
                (click)="
                  onOpenAdmitPopup(
                    $event,
                    'd2c7532c-fb01-11e2-8ff2-fd54ab5fdb2a',
                    'Admission Location',
                    dashboardParams?.currentPatient,
                    activeVisit,
                    dashboardParams?.currentLocation
                  )
                "
              >
                Admit
              </button>
              <button
                mat-menu-item
                (click)="
                  onOpenTransferWithinPopup(
                    $event,
                    'a007bbfe-fbe5-11e2-8ff2-fd54ab5fdb2a',
                    'Treatment Room',
                    dashboardParams?.currentPatient,
                    activeVisit,
                    dashboardParams?.currentLocation
                  )
                "
              >
                Transfer within
              </button>
              <button
                mat-menu-item
                [disabled]="
                  dashboardParams?.startingConsultation ||
                  (!activeVisit?.isEmergency &&
                    dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType) ||
                  activeVisitDeathStatus ||
                  !dashboardParams?.provider
                "
                (click)="
                  onOpenPopup(
                    $event,
                    'iCARE703-FORM-4df6-a364-abc9b1f48193',
                    'Refer-to Location',
                    dashboardParams?.currentPatient,
                    activeVisit,
                    dashboardParams?.currentLocation,
                    null,
                    dashboardParams?.provider,
                    dashboardParams?.facilityDetails.results,
                    dashboardParams?.observationsGroupedByConcept,
                    dashboardParams?.generalPrescriptionOrderType,
                    dashboardParams?.useGeneralPrescription,
                    true
                  )
                "
              >
                Refer
              </button>
              <button
                mat-menu-item
                [disabled]="
                  activeVisitDeathStatus || !dashboardParams?.provider
                "
                (click)="
                  onOpenPopup(
                    $event,
                    '73d36615-9a4a-46a4-8134-2dca15acacc1',
                    null,
                    dashboardParams?.currentPatient,
                    activeVisit,
                    dashboardParams?.currentLocation,
                    null,
                    dashboardParams?.provider,
                    false
                  )
                "
              >
                Mark Patient Deceased
              </button>
            </mat-menu>

            <span
              class="ml-2 text-left"
              *ngIf="dashboardParams?.currentPatient"
            >
              <app-is-first-visit
                [patient]="dashboardParams?.currentPatient?.patient?.uuid"
              ></app-is-first-visit>
            </span>
            <button
              class="ml-2"
              [disabled]="
                codedVisitCloseStatus && codedVisitCloseStatus?.display
              "
              *ngIf="
                dashboardParams?.visitEndingControlStatusesConcept &&
                dashboardParams?.currentPatient &&
                visitEndingControlStatusesConceptUuid !== 'none'
              "
              mat-stroked-button
              (click)="
                onOpenModalToEndConsultation(
                  $event,
                  dashboardParams?.visitEndingControlStatusesConcept,
                  dashboardParams?.consultationEncounterType,
                  dashboardParams?.provider,
                  dashboardParams?.currentLocation,
                  activeVisit,
                  dashboardParams?.currentPatient?.patient
                )
              "
            >
              End consultation
            </button>
            <span
              color="primary"
              class="ml-2"
              style="margin-top: 8px"
              *ngIf="codedVisitCloseStatus && codedVisitCloseStatus?.display"
            >
              Visit status: {{ codedVisitCloseStatus?.display }}
            </span>
          </div>
        </div>
        <!-- Patient clinic content -->
        <div
          *ngIf="
            !dashboardParams?.startingConsultation &&
            !(
              !activeVisit?.isEmergency &&
              dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType
            ) && !activeVisit?.waitingToBeAdmitted
          "
        >
          <div class="p-2">
            <div class="row">
              <div
                [ngClass]="{
                  'col-lg-6 col-md-6 col-sm-12 col-sx-12': !isInpatient,
                  'col-lg-8 col-md-8 col-sm-12 col-sx-12 obs-table': isInpatient
                }"
              >
                <mat-progress-bar
                  *ngIf="!readyForClinicalNotes"
                  mode="indeterminate"
                >
                </mat-progress-bar>
                <app-clinical-notes
                  *ngIf="
                    !isInpatient &&
                    readyForClinicalNotes &&
                    !dashboardParams.loadingForms &&
                    dashboardParams.currentPatient &&
                    dashboardParams?.forms &&
                    dashboardParams?.forms?.length > 0
                  "
                  [clinicalObservations]="
                    dashboardParams?.observationsGroupedByConcept
                  "
                  [patient]="dashboardParams?.currentPatient"
                  [location]="dashboardParams?.currentLocation"
                  [visit]="activeVisit"
                  [forms]="dashboardParams?.forms"
                  [shouldUseOwnFormSelection]="false"
                  [provider]="dashboardParams?.provider"
                  (updateConsultationOrder)="onUpdateConsultationOrder()"
                  [selectedForm]="
                    selectedForm ? selectedForm : dashboardParams?.forms[0]
                  "
                  (saveObservations)="
                    onSaveObservations($event, params?.currentPatient)
                  "
                >
                </app-clinical-notes>

                <!-- For IPD -->
                <app-patient-observations-chart
                  *ngIf="
                    isInpatient &&
                    !dashboardParams.loadingForms &&
                    dashboardParams.currentPatient &&
                    dashboardParams?.forms &&
                    dashboardParams?.forms?.length > 0 &&
                    ((selectedForm &&
                      dashboardParams?.observationChartForm ===
                        selectedForm?.uuid) ||
                      (!selectedForm?.uuid &&
                        dashboardParams?.observationChartForm ===
                          dashboardParams?.forms[0].uuid))
                  "
                  [clinicalObservations]="
                    dashboardParams?.observationsGroupedByConcept
                  "
                  [patient]="dashboardParams?.currentPatient"
                  [location]="dashboardParams?.currentLocation"
                  [visit]="activeVisit"
                  [forms]="dashboardParams?.forms"
                  [shouldUseOwnFormSelection]="false"
                  [obsChartEncounterType]="
                    dashboardParams?.observationChartEncounterType
                  "
                  [provider]="dashboardParams?.provider"
                  [selectedForm]="
                    selectedForm &&
                    dashboardParams?.observationChartForm === selectedForm?.uuid
                      ? selectedForm
                      : dashboardParams?.forms[0]?.uuid ===
                        dashboardParams?.observationChartForm
                      ? dashboardParams?.forms[0]
                      : {}
                  "
                  (saveObservations)="
                    onSaveObservations($event, params?.currentPatient)
                  "
                >
                </app-patient-observations-chart>
                <app-ipd-forms
                  *ngIf="
                    isInpatient &&
                    readyForClinicalNotes &&
                    !dashboardParams.loadingForms &&
                    dashboardParams.currentPatient &&
                    dashboardParams?.forms &&
                    dashboardParams?.forms?.length > 0 &&
                    ((selectedForm &&
                      selectedForm?.uuid &&
                      dashboardParams?.observationChartForm !==
                        selectedForm?.uuid) ||
                      (!selectedForm &&
                        dashboardParams?.observationChartForm !==
                          dashboardParams?.forms[0]?.uuid))
                  "
                  [clinicalObservations]="
                    dashboardParams?.observationsGroupedByConcept
                  "
                  [patient]="dashboardParams?.currentPatient"
                  [location]="dashboardParams?.currentLocation"
                  [visit]="activeVisit"
                  [forms]="dashboardParams?.forms"
                  [shouldUseOwnFormSelection]="false"
                  [provider]="dashboardParams?.provider"
                  [selectedForm]="
                    selectedForm &&
                    dashboardParams?.observationChartForm !== selectedForm?.uuid
                      ? selectedForm
                      : dashboardParams?.forms[0]?.uuid !==
                        dashboardParams?.observationChartForm
                      ? dashboardParams?.forms[0]
                      : {}
                  "
                  (saveObservations)="
                    onSaveObservations($event, params?.currentPatient)
                  "
                >
                </app-ipd-forms>

                <div
                  class="alert alert-warning"
                  role="alert"
                  *ngIf="
                    readyForClinicalNotes &&
                    !dashboardParams.loadingForms &&
                    dashboardParams.currentPatient &&
                    dashboardParams?.forms &&
                    dashboardParams?.forms?.length === 0
                  "
                >
                  NO Forms assigned for this Doctor's Room, Contact IT
                </div>
              </div>

              <div
                [ngClass]="{
                  'col-lg-6 col-md-6 col-sm-12 col-sx-12': !isInpatient,
                  'col-lg-4 col-md-4 col-sm-12 col-sx-12': isInpatient
                }"
              >
                <mat-accordion *ngIf="isInpatient">
                  <mat-expansion-panel
                    class="mb-2 border p-0"
                    [expanded]="isInpatient ? true : false"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>Medication </mat-panel-title>
                    </mat-expansion-panel-header>
                    <app-patient-medication-summary
                      *ngIf="activeVisit"
                      [fromDispensing]="false"
                      [patientVisit]="activeVisit"
                      [forConsultation]="true"
                      [isInpatient]="isInpatient"
                      (updateConsultationOrder)="onUpdateConsultationOrder()"
                    ></app-patient-medication-summary>
                  </mat-expansion-panel>
                </mat-accordion>
                <mat-accordion
                  *ngIf="
                    userPrivileges['CLINIC_ADD_PROVISIONAL_DIAGNOSIS'] &&
                    !isInpatient
                  "
                >
                  <mat-expansion-panel
                    class="mb-2 border p-0"
                    [expanded]="true"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>Provisional Diagnoses </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div
                      *ngIf="dashboardParams?.formEntities['Visit Diagnoses']"
                    >
                      <app-patient-diagnoses-summary
                        [isConfirmedDiagnosis]="false"
                        [forConsultation]="true"
                        [diagnosisFormDetails]="
                          dashboardParams?.formEntities['Visit Diagnoses']
                        "
                        [patientVisit]="activeVisit"
                        [isInpatient]="isInpatient"
                        (updateConsultationOrder)="onUpdateConsultationOrder()"
                      ></app-patient-diagnoses-summary>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
                <mat-accordion>
                  <mat-expansion-panel
                    *ngIf="
                      userPrivileges['CLINIC_ADD_LABORATORY_INVESTIGATION'] ||
                      userPrivileges['CLINIC_ADD_RADIOLOGY_INVESTIGATION'] ||
                      userPrivileges['CLINIC_ADD_PROCEDURE_ORDER']
                    "
                    class="mb-2 border p-0"
                    [expanded]="false"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title
                        >Investigation / Procedures
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <app-patient-investigations-and-procedures
                      *ngIf="
                        activeVisit &&
                        dashboardParams?.formEntities['All orderables']
                      "
                      [observations]="
                        dashboardParams?.observationsGroupedByConcept
                      "
                      [investigationAndProceduresFormsDetails]="
                        dashboardParams?.formEntities['All orderables']
                      "
                      [patientVisit]="activeVisit"
                      [forConsultation]="true"
                      [provider]="dashboardParams?.provider"
                      [orderTypes]="dashboardParams?.orderTypes"
                      [iCareGeneralConfigurations]="iCareGeneralConfigurations"
                      [clinicConfigurations]="clinicConfigurations"
                      [userPrivileges]="userPrivileges"
                      [fromConsultation]="true"
                      [isInpatient]="isInpatient"
                      (updateConsultationOrder)="onUpdateConsultationOrder()"
                    ></app-patient-investigations-and-procedures>

                    <mat-progress-bar
                      *ngIf="
                        dashboardParams?.loadingVisit ||
                        !activeVisit ||
                        !dashboardParams?.formEntities['All orderables'] ||
                        !dashboardParams?.provider ||
                        !dashboardParams?.orderTypes
                      "
                      mode="indeterminate"
                    ></mat-progress-bar>
                  </mat-expansion-panel>
                </mat-accordion>

                <mat-accordion
                  *ngIf="userPrivileges['CLINIC_ADD_CONFIRMED_DIAGNOSIS']"
                >
                  <mat-expansion-panel
                    class="mb-2 border p-0"
                    [expanded]="false"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>Confirmed Diagnoses </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div
                      *ngIf="dashboardParams?.formEntities['Visit Diagnoses']"
                    >
                      <app-patient-diagnoses-summary
                        [isConfirmedDiagnosis]="true"
                        [forConsultation]="true"
                        [patientVisit]="activeVisit"
                        [diagnosisFormDetails]="
                          dashboardParams?.formEntities['Visit Diagnoses']
                        "
                        [isInpatient]="isInpatient"
                        (updateConsultationOrder)="onUpdateConsultationOrder()"
                      ></app-patient-diagnoses-summary>
                    </div>
                    <mat-progress-bar
                      *ngIf="!dashboardParams?.formEntities['Visit Diagnoses']"
                      mode="indeterminate"
                    ></mat-progress-bar>
                  </mat-expansion-panel>
                </mat-accordion>

                <mat-accordion
                  *ngIf="
                    userPrivileges['CLINIC_ADD_PRESCRIPTION'] && !isInpatient
                  "
                >
                  <mat-expansion-panel
                    class="mb-2 border p-0"
                    [expanded]="false"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>Medication </mat-panel-title>
                    </mat-expansion-panel-header>
                    <app-patient-medication-summary
                      *ngIf="activeVisit"
                      [fromDispensing]="false"
                      [patientVisit]="activeVisit"
                      [forConsultation]="true"
                      [isInpatient]="isInpatient"
                      (updateConsultationOrder)="onUpdateConsultationOrder()"
                    ></app-patient-medication-summary>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
            </div>
          </div>
          <!-- <mat-tab label="Trends">
            <div class="p-3">
              <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">BP</h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Diabetes/Blood Sugar
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Temperature
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Growth Chart
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Weight/BMI
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">Pulse</h3>
                  <mat-card> no data </mat-card>
                </div>
              </div>
            </div>
          </mat-tab>
          <mat-tab label="Summary">
            <div class="p-3">
              <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Problem History
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Medication
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Bacteriology Results
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">
                    Chronic Treatment Chart
                  </h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">Radiology</h3>
                  <mat-card> no data </mat-card>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col-sx-12 mb-3">
                  <h3 class="border-bottom border-secondary mb-2">Pulse</h3>
                  <mat-card> no data </mat-card>
                </div>
              </div>
            </div>
          </mat-tab> -->
          <!-- </mat-tab-group> -->
          <div
            *ngIf="
              (!activeVisit?.isEnsured &&
                !dashboardParams?.loadingVisit &&
                activeVisit &&
                dashboardParams?.startingConsultation) ||
              (!activeVisit?.isEmergency &&
                dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType)
            "
            class="alert alert-danger p-3 ml-2 mr-2"
            role="alert"
          >
            Consultation Fee not paid
          </div>
          <!-- end of Patient clinic content -->
        </div>
        <div
          class="alert alert-danger mt-4 ml-2 mr-2"
          *ngIf="
            !activeVisit?.isEmergency &&
            dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType
          "
          role="alert"
        >
          Not paid for Consultation Service
        </div>
        
        <div
          class="alert alert-warning mt-4 ml-2 mr-2"
          *ngIf="
            !activeVisit?.isEmergency &&
            dashboardParams?.hasPatientHavePendingPaymentForTheCurrentVisitType ||
            activeVisit?.waitingToBeAdmitted
          "
          role="alert"
        >
          Assign bed to this patient to continue
        </div>
      </div>
    </div>
  </div>
  <mat-progress-bar
    *ngIf="
      dashboardParams?.loadingPaymentStatus ||
      !dashboardParams?.encounterTypes ||
      dashboardParams?.billLoadingState ||
      !dashboardParams?.currentPatient ||
      dashboardParams?.loadingForms
    "
    mode="indeterminate"
  >
  </mat-progress-bar>
</div>
