<div class="observations-chart-table-container">
  <table class="table table-bordered table-striped" *ngIf="selectedForm">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th *ngFor="let formField of selectedForm?.formFields" class="w-100">
          {{ formField?.name }}
          <span class="ml-2" *ngIf="formField?.concept?.units"
            >({{ formField?.concept?.units }})</span
          >
          <ng-container *ngIf="formField?.formFields">
           <th *ngFor="let subFormField of formField?.formFields">
            {{ subFormField?.label }}
            <span class="ml-2" *ngIf="formField?.concept?.units"
              >({{ subFormField?.units }})</span> </th>
          </ng-container>
          <ng-container *ngIf="formField?.setMembers">
            <div *ngFor="let member of formField?.setMembers">
              <th *ngFor="let memberField of member?.formFields">
               {{ memberField?.label }}
               <span class="ml-2" *ngIf="formField?.concept?.units"
                 >({{ memberField?.units }})</span></th>
            </div>
          </ng-container>
        </th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let encounter of obsChartEncountersData">
        <td>
          {{ encounter?.encounterDatetime | date: "medium" }}
        </td>
        <td *ngFor="let formField of selectedForm?.formFields">
          <!-- TODO: Add support to check if the value is valueObject -->
          {{ encounter?.obsKeyedByConcept[formField?.concept?.uuid]?.value }}
        </td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td *ngFor="let formField of selectedForm?.formFields">
          <app-form
            *ngIf="
              formField &&
              formField?.formField &&
              formField?.setMembers &&
              formField?.setMembers?.length === 0
            "
            [fields]="[formField?.formField]"
            [isFormHorizontal]="false"
            [isReport]="false"
            [fieldsData]=""
            (formUpdate)="onFormUpdate($event)"
          ></app-form>


          <ng-container *ngIf="formField?.formFields">
           <td *ngFor="let subFormField of formField?.formFields">
            <app-form
            [fields]="[subFormField]"
            [isFormHorizontal]="false"
            [isReport]="false"
            [fieldsData]=""
            (formUpdate)="onFormUpdate($event)"
          ></app-form></td>
          </ng-container>
          <ng-container *ngIf="formField?.setMembers">
            <div *ngFor="let member of formField?.setMembers">
              <td *ngFor="let memberField of member?.formFields">
              <app-form
              [fields]="[memberField]"
              [isFormHorizontal]="false"
              [isReport]="false"
              [fieldsData]=""
              (formUpdate)="onFormUpdate($event)"
            ></app-form></td>
            </div>
          </ng-container>


          <!-- <div
            *ngIf="
              formField?.formField &&
              formField?.setMembers &&
              formField?.setMembers?.length > 0
            "
          >
            <td *ngFor="let member of formField?.setMembers">
              <app-form
                [fields]="member?.formFields"
                [isFormHorizontal]="true"
                [fieldsData]="params?.observations"
                [isReport]="isReport"
                (formUpdate)="onFormUpdate($event)"
              >
              </app-form>
            </td>
          </div>
          <div
            *ngIf="
              formField?.formField &&
              formField?.formFields &&
              formField?.formFields?.length > 0
            "
          >
            <td *ngFor="let subField of formField?.formFields">
              <app-form
                [fields]="[subField]"
                [isFormHorizontal]="false"
                [fieldsData]="params?.observations"
                [isReport]="isReport"
                (formUpdate)="onFormUpdate($event)"
              >
              </app-form>
            </td>
          </div> -->
        </td>
        <td class="text-center">
          <button
            [disabled]="!atLeastOneFormFieldHasBeenFilled"
            mat-stroked-button
            color="primary"
            (click)="onSave($event)"
          >
            Save
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
