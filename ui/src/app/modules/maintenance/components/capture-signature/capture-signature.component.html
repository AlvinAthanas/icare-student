<div class="loading-overlay" *ngIf="updatingUser">
  <div class="text-center">
    <div>Saving details...</div>
    <div class="mt-3 d-flex justify-content-center w-100">
      <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
    </div>
  </div>
</div>
<mat-toolbar color="primary">
  <span>Capture signature</span>
  <span class="toolbar-spacer"></span>
  <button mat-icon-button mat-dialog-close matTooltip="close">
    <mat-icon>close</mat-icon>
  </button>
</mat-toolbar>

<div
  class="signature-container w-100 p-2"
  *ngIf="{ providerDetails: providerDetails$ | async } as params"
>
  <canvas
    #sigPad
    width="{{
      params?.providerDetails &&
      params?.providerDetails?.uuid &&
      !params?.providerDetails?.signature
        ? '500'
        : '0'
    }}"
    height="{{
      params?.providerDetails &&
      params?.providerDetails?.uuid &&
      !params?.providerDetails?.signature
        ? '130'
        : '0'
    }}"
    (mousedown)="onMouseDown($event)"
    (mousemove)="onMouseMove($event)"
  ></canvas>
  <img
    *ngIf="params?.providerDetails && params?.providerDetails?.signature"
    height="130"
    [src]="params?.providerDetails?.signature"
  />

  <div
    class="alert alert-danger"
    role="alert"
    *ngIf="params?.providerDetails && !params?.providerDetails?.uuid"
  >
    This user is not a provider!
  </div>

  <mat-progress-bar
    *ngIf="!params?.providerDetails"
    mode="indeterminate"
  ></mat-progress-bar>

  <div class="w-100 d-flex justify-content-end mb-2">
    <button
      mat-stroked-button
      [disabled]="
        (params?.providerDetails &&
          !params?.providerDetails?.signature &&
          !signatureImg) ||
        !params?.providerDetails
      "
      style="bottom: 0; z-index: 1401"
      class="mr-2 action-btns"
      color="primary"
      (click)="clearPad($event)"
    >
      Clear
    </button>
    <button
      mat-stroked-button
      style="bottom: 0; z-index: 1401"
      *ngIf="!alreadySigned"
      [disabled]="
        !params?.providerDetails ||
        (params?.providerDetails &&
          !params?.providerDetails?.signature &&
          !signatureImg)
      "
      class="action-btns"
      color="primary"
      (click)="onSave($event, params?.providerDetails)"
    >
      Save
    </button>
  </div>
</div>
