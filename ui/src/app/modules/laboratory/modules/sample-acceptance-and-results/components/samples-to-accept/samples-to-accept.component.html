<div
  class="w-100"
  *ngIf="{
    samplesToAccept: samplesToAccept$ | async,
    providerDetails: providerDetails$ | async
  } as params"
>
  <mat-progress-bar
    mode="indeterminate"
    *ngIf="!params?.samplesToAccept"
  ></mat-progress-bar>
  <div class="loading-overlay" *ngIf="saving">
    <div class="text-center">
      <div>Saving ....</div>
      <div class="mt-3 d-flex justify-content-center w-100">
        <mat-spinner diameter="50" strokeWidth="2"></mat-spinner>
      </div>
    </div>
  </div>
  <div *ngIf="params?.samplesToAccept">
    <table class="table table-bordered">
      <thead class="table-header">
        <tr>
          <th rowspan="2">SN</th>
          <th rowspan="2">Department/Section</th>
          <th rowspan="2">Sample / Specimen</th>
          <th rowspan="2">Laboratory ID</th>
          <th rowspan="2" *ngIf="!LISConfigurations?.isLIS">MRN</th>
          <th rowspan="2" *ngIf="!LISConfigurations?.isLIS">Patient Names</th>
          <th colspan="2" class="text-center">Test details</th>
          <th rowspan="2" *ngIf="LISConfigurations?.isLIS">Received By</th>
          <th rowspan="2" *ngIf="LISConfigurations?.isLIS">Received On</th>
          <th rowspan="2" *ngIf="LISConfigurations?.isLIS">
            {{ !LISConfigurations?.isLIS ? "Collected By" : "Registered By" }}
          </th>
          <th rowspan="2">
            {{ !LISConfigurations?.isLIS ? "Collected On" : "Registered On" }}
          </th>
          <th rowspan="2">Priority</th>
          <th rowspan="2">Action</th>
        </tr>
        <tr>
          <th>Test Order</th>
          <th>
            {{ !LISConfigurations?.isLIS ? "Collected By" : "ID" }}
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngIf="params?.samplesToAccept?.length > 0">
          <ng-container
            *ngFor="let sample of params?.samplesToAccept; let count = index"
          >
            <tr
              *ngFor="let order of sample?.orders; let orderCount = index"
              [ngClass]="{ 'row-alternated': count % 2 !== 0 }"
            >
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ count + 1 + (page - 1) * pageCount }}
              </td>
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{
                  sample?.department?.name
                    ? sample?.department?.name
                    : "Not set"
                }}
              </td>
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.specimenSource?.specimenName }}
              </td>
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.label }}
              </td>
              <td
                *ngIf="orderCount == 0 && !LISConfigurations?.isLIS"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.mrn }}
              </td>
              <td
                *ngIf="orderCount == 0 && !LISConfigurations?.isLIS"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.patient?.givenName }}
                {{ sample?.patient?.middleName }}
                {{ sample?.patient?.familyName }}
              </td>
              <td>
                {{ order?.order?.concept?.display }}
              </td>
              <td>
                {{
                  !LISConfigurations?.isLIS
                    ? order?.order?.orderer?.name
                    : order?.order?.orderNumber
                }}
              </td>
              <td
                *ngIf="orderCount == 0 && LISConfigurations?.isLIS"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.receivedByStatus?.user?.name }}
              </td>
              <td
                *ngIf="orderCount == 0 && LISConfigurations?.isLIS"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{
                  sample?.receivedOnStatus?.timestamp
                    ? (sample?.receivedOnStatus?.remarks | date: "medium")
                    : ""
                }}
              </td>
              <td
                *ngIf="orderCount == 0 && LISConfigurations?.isLIS"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.collectedBy?.display }}
              </td>
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{ sample?.dateCreated | date: "medium" }}
              </td>
              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                {{
                  !LISConfigurations?.isLIS
                    ? sample?.priorityHigh
                      ? "Urgent"
                      : "Routine"
                    : sample?.priorityStatus?.status
                    ? sample?.priorityStatus?.status
                    : "Routine"
                }}
              </td>

              <td
                *ngIf="orderCount == 0"
                [attr.rowspan]="sample?.orders?.length"
              >
                <div class="d-flex justify-content-center">
                  <button
                    *ngIf="!LISConfigurations?.isLIS"
                    mat-stroked-button
                    class="accept-button"
                    (click)="accept($event, sample, params?.providerDetails)"
                  >
                    Accept
                  </button>

                  <button
                    *ngIf="!LISConfigurations?.isLIS"
                    mat-stroked-button
                    (click)="reject($event, sample, params?.providerDetails)"
                    class="ml-2 reject-button"
                  >
                    Reject
                  </button>
                  <button
                    *ngIf="LISConfigurations?.isLIS"
                    mat-flat-button
                    color="primary"
                    (click)="onToggleViewSampleDetails($event, sample)"
                  >
                    <mat-icon *ngIf="!samplesToViewMoreDetails[sample?.id]"
                      >expand_more</mat-icon
                    >
                    <mat-icon *ngIf="samplesToViewMoreDetails[sample?.id]"
                      >expand_less</mat-icon
                    >
                    {{
                      !samplesToViewMoreDetails[sample?.id] ? "View" : "Hide"
                    }}
                    Details
                  </button>
                </div>
              </td>
            </tr>
            <tr
              *ngIf="samplesToViewMoreDetails[sample?.id]"
              class="sample-details-row"
            >
              <td colspan="11">
                <app-shared-sample-details
                  [sample]="sample"
                ></app-shared-sample-details>
              </td>
              <td>
                <div class="d-flex justify-content-center">
                  <button
                    [disabled]="
                      sample.accepted ||
                      sample.rejected ||
                      sampleParams?.settingLabSampleStatus
                    "
                    mat-stroked-button
                    class="accept-button"
                    (click)="
                      accept($event, sample, sampleParams?.providerDetails)
                    "
                  >
                    <mat-spinner
                      *ngIf="
                        sampleParams?.settingLabSampleStatus &&
                        savingMessage[sample?.id + '-accept']
                      "
                      [diameter]="16"
                    >
                    </mat-spinner>
                    Accept
                  </button>

                  <button
                    [disabled]="sample?.accepted || sample?.rejected"
                    mat-stroked-button
                    (click)="
                      reject($event, sample, sampleParams?.providerDetails)
                    "
                    class="ml-2 reject-button"
                  >
                    <mat-spinner
                      *ngIf="
                        sampleParams?.settingLabSampleStatus &&
                        savingMessage[sample?.id + '-reject']
                      "
                      [diameter]="16"
                      style="
                        display: inline-block !important;
                        margin-right: 4px;
                      "
                    >
                    </mat-spinner>
                    Reject
                  </button>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>
        <ng-container *ngIf="params?.samplesToAccept?.length === 0">
          <tr>
            <td colspan="100%">
              <div class="alert alert-warning" role="alert">
                No sample to ready for acceptance or rejection
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
